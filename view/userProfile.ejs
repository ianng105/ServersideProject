<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User Profile - HealthyPal</title>
  <style>
    :root{
      --brand:#3b82f6;
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e2e8f0;
      --success: #10b981;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    a{color:var(--brand);text-decoration:none}
    .container{max-width:980px;margin:0 auto;padding:16px}

    /* 顶部导航 */
    .nav{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;background:var(--card);border:1px solid var(--border);
      border-radius:14px;padding:10px 12px;margin-bottom:16px;
    }
    .nav-left,.nav-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .brand{font-weight:800;letter-spacing:.2px}
    .btn{
      padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;color:var(--text);font-weight:600;
      cursor:pointer;transition:all 0.2s ease;
    }
    .btn:hover{
      background:#f1f5f9;
    }
    .btn-primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .btn-primary:hover{
      background:#2563eb;
    }
    .danger{color:#ef4444}

    /* 成功提示 */
    .alert-success {
      background-color: #d1fae5;
      color: #047857;
      border: 1px solid #a7f3d0;
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 16px;
      text-align: center;
      font-weight: 600;
    }

    /* 头像区 */
    .profile-card{
      background:var(--card);border:1px solid var(--border);border-radius:16px;
      padding:22px 16px;margin-bottom:16px;text-align:center;
      display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;
    }
    .avatar{
      width:140px;height:140px;
      border-radius:50%;object-fit:cover;display:block;
      border:3px solid #fff;box-shadow:0 8px 24px rgba(2,6,23,0.08);
    }
    .username{font-size:24px;font-weight:800;margin-top:4px}
    .profile-bio {
      color: var(--muted);
      max-width: 500px;
      line-height: 1.5;
    }

    /* 主体布局 */
    .main-grid{
      display:grid;grid-template-columns:1fr 1fr;gap:16px;
    }
    @media (max-width: 900px){
      .main-grid{grid-template-columns:1fr}
    }

    .card{
      background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;
      box-shadow:0 1px 3px rgba(0,0,0,0.05);
    }
    .card h3{margin:0 0 16px;font-size:18px;color:var(--brand);border-bottom:1px solid var(--border);padding-bottom:8px;}
    .info-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 12px;
      align-items: center;
    }
    .info-grid strong {
      color: var(--muted);
      justify-self: start;
      min-width: 100px;
    }
    .info-grid span {
      word-break: break-all;
    }

    /* 日历样式 */
    .calendar{
      --cell-size:42px;
      --cell-font:12px;
      --header-font:14px;
      --dow-font:11px;
    }
    .calendar-header{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:8px
    }
    .calendar-title{font-weight:700;font-size:var(--header-font)}
    .calendar-grid{
      display:grid;grid-template-columns:repeat(7,1fr);gap:6px;
    }
    .dow{
      text-align:center;color:var(--muted);font-size:var(--dow-font);padding:4px 0
    }
    .day{
      height:var(--cell-size);display:flex;align-items:center;justify-content:center;
      border:1px solid var(--border);border-radius:10px;font-size:var(--cell-font);
      background:#fff;
    }
    .day.today{border-color:var(--brand);box-shadow:0 0 0 2px rgba(59,130,246,0.15) inset}
    .day.muted{color:#94a3b8;background:#f8fafc}
  </style>
</head>
<body>

  <div class="container">
    <!-- 顶部导航 -->
    <nav class="nav">
      <div class="nav-left">
        <span class="brand">HealthyPal</span>
        <a href="/main" class="btn">Home</a>
      </div>
      <div class="nav-right">
        <a href="/editProfile" class="btn btn-primary">Edit Profile</a>
      </div>
    </nav>

    <!-- 成功提示 -->
    <% if (typeof success !== 'undefined' && success === 'updated') { %>
      <div class="alert-success">Profile updated successfully!</div>
    <% } %>

    <!-- 个人信息概览 -->
    <section class="profile-card">
      <img class="avatar" 
           src="<%= user.avatar ? user.avatar : 'data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22140%22 height=%22140%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23e2e8f0%22/><text x=%2250%25%22 y=%2252%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2256%22 fill=%22%2364758b%22 font-family=%22sans-serif%22>%F0%9F%91%A4</text></svg>' %>" 
           alt="<%= user.username %>'s avatar">
      <div class="username"><%= user.username %></div>
      <p class="profile-bio"><%= user.profile ? user.profile : 'No profile description yet. Tell others about your fitness journey!' %></p>
    </section>

    <!-- 主体：信息与日历 -->
    <div class="main-grid">
      <section class="card">
        <h3>Personal Details</h3>
        <div class="info-grid">
          <strong>Username:</strong> <span><%= user.username %></span>
        </div>
        <div class="info-grid">
          <strong>Email:</strong> <span><%= user.email %></span>
        </div>
        <form method="POST" action="/delete">
        	<button type=submit>Delete Account</button>
        </form>
        <% if (user.height || user.weight || user.gender || user.birthday || user.goal || user.TDEE || user.minimumIntake || user.maximumIntake) { %>
          <div style="margin-top: 10px; font-style: italic; color: var(--muted);">Body Information (only visible if set):</div>
          <% if (user.height) { %>
            <div class="info-grid">
              <strong>Height:</strong> <span><%= user.height + ' cm' %></span>
            </div>
          <% } %>
          <% if (user.weight) { %>
            <div class="info-grid">
              <strong>Weight:</strong> <span><%= user.weight + ' kg' %></span>
            </div>
          <% } %>
          <% if (user.gender) { %>
            <div class="info-grid">
              <strong>Gender:</strong> <span><%= user.gender %></span>
            </div>
          <% } %>
          <% if (user.birthday) { %>
            <div class="info-grid">
              <strong>Birthday:</strong> <span><%= new Date(user.birthday).toLocaleDateString() %></span>
            </div>
          <% } %>
          <% if (user.goal) { %>
            <div class="info-grid">
              <strong>Fitness Goal:</strong> <span><%= user.goal %></span>
            </div>
          <% } %>
          <% if (user.TDEE) { %>
            <div class="info-grid">
              <strong>Daily Calorie Target:</strong> <span><%= user.TDEE + ' kcal' %></span>
            </div>
          <% } %>
          <% if (user.minimumIntake && user.maximumIntake) { %>
            <div class="info-grid">
              <strong>Intake Range:</strong> <span><%= user.minimumIntake %> - <%= user.maximumIntake %> kcal</span>
            </div>
          <% } %>
        <% } %>
      </section>

      <section class="card calendar">
        <h3>Activity Calendar</h3>
        <div class="calendar-header">
          <div class="calendar-title"><%= new Date().toLocaleDateString('default', { month: 'long', year: 'numeric' }) %></div>
        </div>
        <div class="calendar-grid">
          <div class="dow">Sun</div><div class="dow">Mon</div><div class="dow">Tue</div><div class="dow">Wed</div><div class="dow">Thu</div><div class="dow">Fri</div><div class="dow">Sat</div>
          <%
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const firstDay = new Date(year, month, 1);
            const startDow = firstDay.getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const prevMonthDays = new Date(year, month, 0).getDate();
            const totalCells = 42; // 6 rows * 7 days
            for (let i = 0; i < totalCells; i++) {
              let dayNum, cls = 'day';
              if (i < startDow) {
                dayNum = prevMonthDays - startDow + 1 + i;
                cls += ' muted';
              } else if (i >= startDow + daysInMonth) {
                dayNum = i - (startDow + daysInMonth) + 1;
                cls += ' muted';
              } else {
                dayNum = i - startDow + 1;
                const isToday = (dayNum === today.getDate());
                if (isToday) cls += ' today';
              }
          %>
            <div class="<%= cls %>"><%= dayNum %></div>
          <% } %>
        </div>
      </section>
    </div>
  </div>

</body>
</html>
