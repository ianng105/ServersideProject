<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HealthyPal-gym share platform</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="/css/main.css"/>
  <style>
    .content {
      margin-left: 180px; /* 与侧边栏宽度一致 */
      padding: 32px 24px;
    }
    .feed {
      max-width: 860px;
      margin: 0 auto;
      display: grid;
      gap: 20px;
    }
    .post-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      overflow: hidden;
    }
    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
    }
    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      background: #eee;
    }
    .username {
      font-weight: 600;
      color: #111827;
      font-size: 14px;
    }
    .post-image {
      width: 100%;
      display: block;
      max-height: 640px;
      object-fit: cover;
      background: #f3f4f6;
    }
    .post-body {
      padding: 12px 16px 16px;
    }
    .post-food{
       padding: 12px 16px 16px;
    }
    .caption {
      color: #374151;
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-wrap;
    }
    .empty {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      padding: 24px;
      text-align: center;
      color: #6b7280;
    }
    .empty a {
      color: #3b82f6;
      text-decoration: none;
      font-weight: 600;
    }
    .empty a:hover { text-decoration: underline; }
    .btn{
      appearance:none; -webkit-appearance:none;
      border:0;
      padding:10px 16px;
      border-radius:10px;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      display:inline-flex; align-items:center; justify-content:center;
      gap:8px;
      transition: transform .02s ease, box-shadow .2s, background .2s, color .2s;
      user-select:none;
      white-space:nowrap;
text-decoration: none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn-secondary{
      background:var(--secondary);
      color:#111827;
    }
    .btn-secondary:hover{
      background:#dfe3e8;
    }
    .btn-primary{
      background:var(--primary);
      color:#fff;
      box-shadow: 0 6px 14px rgba(59,130,246,.25);
    }
    .btn-primary:hover{ background:var(--primary-dark); }

    /* 右上角圆形按钮 */
    .floating-profile-btn {
      position: fixed;
      right: 20px;
      top: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #3b82f6;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 20px rgba(59,130,246,0.35);
      cursor: pointer;
      text-decoration: none;
      z-index: 1000;
      transition: transform .15s ease, box-shadow .15s ease, background .2s ease;
    }
    .floating-profile-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(59,130,246,0.45);
      background: #2563eb;
    }
    .floating-profile-btn:active { transform: translateY(0); }
    .floating-profile-btn i { font-size: 22px; }
    .right-rail{
  position:sticky; top:16px;
  align-self:start;
  padding:16px 0;
}
    .diet-card{
      margin-top:6px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      box-shadow:var(--shadow);
      padding:12px;
      display:flex; flex-direction:column; gap:10px;
    }
    .diet-header{display:flex;align-items:center;justify-content:space-between;gap:8px;}
    .diet-title{font-weight:700;font-size:25px;margin:0;}
    .diet-total{margin-right: 160px; /* 控制离右边距离 */font-size: 16px;font-weight: 600;}
    .diet-list{display:flex;flex-direction:column;gap:8px;max-height:var(--diet-h);overflow:auto;padding-right:4px;}
    .diet-item{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;border:1px solid var(--border);border-radius:10px;padding:8px;background:#fff;}
    .diet-main{min-width:0;}
    .diet-name{font-size:18px;font-weight:600;margin:0 0 2px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}
    .diet-meta{font-size:15px;color:var(--muted);}
    .diet-actions{display:flex;gap:6px;}
.content{ padding:24px 0; } /* 网格已提供左右间距，这里去掉过宽的 padding */
.feed{ max-width:820px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }
.layout{
  display:grid;
  grid-template-columns: 230px 1fr 500px; 
  gap: 50px;
  min-height: 100dvh;
  align-items:start;
}
    

/* 左侧导航栏保持原状 */
.sidebar{
  position:sticky; top:0; height:100dvh;
  background:#fff; border-right:1px solid #eef0f3;
  padding:16px 12px;
  display:flex; flex-direction:column; gap:14px;
}


/* 右侧栏容器 */
.right-rail{
  position:sticky; top:16px;
  align-self:start;
  padding:16px 0;
}

    @media (max-width: 900px) {
      .content { margin-left: 0; padding: 16px; }
      .floating-profile-btn {
        right: 14px;
        top: 14px;
        width: 52px;
        height: 52px;
      }
    }
     :root{
      --primary:#3b82f6;      /* 主按钮蓝色 */
      --primary-dark:#2563eb;
      --secondary:#e5e7eb;    /* 次按钮浅灰 */
     }
     .post-card {

padding: 20px;

border: 1px solid #e6e6e6;

border-radius: 12px;

background: #fff;

box-shadow: 0 4px 16px rgba(0,0,0,0.06);

font-size: 16px; /* 放大文字 */

line-height: 1.6;

}

.post-header {

font-weight: 600;

font-size: 18px; /* 用户名更显眼 */

margin-bottom: 10px;

}

.post-image {
width: 100%;
max-height: 420px; /* 图片更高 */
object-fit: cover;
border-radius: 10px;
margin: 12px 0;
}

.post-caption {
font-size: 16px;
margin: 8px 0 4px;
white-space: pre-wrap;

}
.post-time {
  font-size: 13px;
  color: #666;
  margin-bottom: 6px; /* 与内容保持间距 */
}

.list{display:flex;flex-direction:column;gap:8px;max-height:60vh;overflow:auto;padding-right:4px;}
  .diet-item{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;border:1px solid var(--line);border-radius:10px;padding:8px;background:#fff;}
  .diet-name{font-weight:700;font-size:13.5px;margin:0 0 2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
  </style>
</head>
<body>
  <a href="/userProfile" class="floating-profile-btn" title="Profile">
  <!-- 使用用户头像 头像替换默认图标 -->
    <img 
      src="<%= currentUser.avatar || '/images/default-avatar.jpg' %>" 
      alt="Profile" 
      class="profile-avatar"
    >
  </a>
<div class="layout">
  <!-- 左侧侧边栏 -->
  <aside class="sidebar">
    <div class="brand">
  <% if (typeof displayName !== 'undefined' && displayName) { %>
    <strong>Hi <%= displayName %>, welcome to HealthyPal</strong>
  <% } else { %>
    HealthyPal
  <% } %>
</div>
    <nav>
      <a class="active" href="/main">
        <i class="fa-solid fa-house"></i>
        <span>Home</span>
      </a>
      <a href="/newPost">
        <i class="fa-solid fa-upload"></i>
        <span>Share</span>
      </a>
      <a href="/bodyInfo">
        <i class="fa-solid fa-chart-line"></i>
        <span>Body Info</span>
      </a>
       </nav>
    <a href="/logout" class="logout">
      <i class="fa-solid fa-right-from-bracket"></i>
      <span>Logout</span>
    </a>
  </aside>

  <!-- 中间内容：帖子流（依据你提供的模板结构渲染） -->
  <main class="content">
    <section class="feed">
      <% if (posts && posts.length > 0) { %>
        <% posts.forEach(post => { %>
          <article class="post-card">
            <div class="post-time">
             <%= new Date(post.date).toLocaleString() %>
              </div>
            <header class="post-header">
              <img class="avatar" src="<%= (post.user && post.user.avatar) ? post.user.avatar : '/images/avatar.jpg' %>" alt="avatar" />
              <div class="username"><%= post.user && post.user.username ? post.user.username : '匿名用户' %></div>
              <div><%=post.healthyJudge%></div>
              <% if(post.healthyJudge=="Healthy"){%>
              	<img src="/healthy.png" height="40px" width="40px">
              <%}%>
              <%if(post.healthyJudge=="Fat"){%>
              	<img src="/fat.png" height="40px" width="40px">
              <%}%>
              <%if(post.healthyJudge=="Unhealthy"){%>
              	<img src="/unhealthy.png" height="40px" width="40px">
              <%}%>
            </header>

            <% if (post.image) { %>
              <img class="post-image" src="<%= post.image %>" alt="post image" style="max-width:100%;height:auto;"/>
            <% } %>

            <div class="post-body">
              <% if (post.caption) { %>
               <%= post.caption %>
              <% } %>
            </div>
              <div class="post-food">
               <% if (typeof post.totalCaloriesSnapshot !== 'undefined') { %>
          <div>Total calories：<%= post.totalCaloriesSnapshot %> kcal</div>
          <% } %>
        <% if (Array.isArray(post.eatenListSnapshot) && post.eatenListSnapshot.length > 0) { %>
        <ul>
       <% post.eatenListSnapshot.forEach(it => { %>
        <li>
          <%= it.food_name %> - <%= Number(it.calories)||0 %> kcal/portion × <%= Number(it.quantity)||1 %>
          </li>
         <% }) %>
        </ul>
      <% } %>
      </div>
            
      </article>
        <% }); %>
      <% } else { %>
        <div class="empty">
          There are no fitness sharing posts at the moment. Go ahead and post your own updates!！<br/>
          <a href="/newPost">Immediately release</a>
        </div>
      <% } %>
    </section>
  </main>

  <!-- 右侧：记录饮食区域（从左侧移过来） -->
  <aside class="right-rail">
    <section class="diet-card" aria-label="记录饮食">
      <div class="diet-header" style="display:flex;align-items:center;justify-content:space-between;">
        <h3 class="diet-title">Food Record</h3>
        <div class="diet-total">
          Total Calories Today：<strong><%= typeof totalCalories !== 'undefined' ? totalCalories : 0 %></strong> kcal
        </div>
      </div>

      <div class="list">
        <% if (Array.isArray(eatenList) && eatenList.length > 0) { %>
          <% eatenList.forEach(item => { %>
            <div class="diet-item">
              <div>
                <p class="diet-name"><%= item.food_name %></p>
                <div class="muted">
                  <%= Number(item.calories) || 0 %> kcal/portion
                  · portion：<%= Number(item.quantity) || 1 %>
                  · sum：<%= (Number(item.calories)||0) * (Number(item.quantity)||1) %> kcal
                </div>
              </div>
              <form action="/eaten/remove" method="post">
                <input type="hidden" name="id" value="<%= item.id %>">
                
              </form>
            </div>
          <% }) %>
        <% } else { %>
          <div class="diet-item" style="border-style:dashed;">
            <div>
              <p class="diet-name">Not record yet</p>
              
            </div>
          </div>
        <% } %>
      </div>

      <div style="display:flex;gap:8px;justify-content:space-between;align-items:center;">
        <a class="btn btn-primary" href='/searchFood'>Go to add</a>
      </div>
    </section>
  </aside>
</div>

       

</body>
</html>







