<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HealthyPal - Body Info</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/bodyInfo.css"/>
</head>
<body>
  <aside class="sidebar">
    <h2>BodyInfo</h2>
    <nav>
      <a href="/main">
        <i class="fa-solid fa-house"></i>
        <span>Home</span>
      </a>
      <a href="/newPost">
        <i class="fa-solid fa-upload"></i>
        <span>Share</span>
      </a>
      <a class="active" href="/bodyInfo">
        <i class="fa-solid fa-chart-line"></i>
        <span>Body Info</span>
      </a>
      <a href="/searchFood">
        <i class="fa-solid fa-utensils"></i>
        <span>Search Food</span>
      </a>
    </nav>
    <a href="/logout" class="logout">
      <i class="fa-solid fa-right-from-bracket"></i>
      <span>Logout</span>
    </a>
  </aside>

  <main class="content">
    <section class="card">
      <div class="card-header">
        <i class="fa-solid fa-dumbbell"></i>
        <div class="card-title">Enter / Update Your Body Info</div>
      </div>

     <form class="body-form" action="/bodyInfo" method="POST">
        
        <div class="field">
          <label for="height">Height (cm)</label>
          <input type="number" id="height" name="height" min="50" max="260" step="0.1" 
                 value="<%= userBody.height || '' %>" placeholder="e.g., 172.5" required />
          <div class="hint">Used to calculate BMI and BMR</div>
        </div>

        <div class="field">
          <label for="weight">Weight (kg)</label>
          <input type="number" id="weight" name="weight" min="20" max="400" step="0.1" 
                 value="<%= userBody.weight || '' %>" placeholder="e.g., 65.2" required />
        </div>

        <div class="field">
          <label for="gender">Gender</label>
          <select id="gender" name="gender" required>
            <option value="">Please choose</option>
            <option value="male"   <%= userBody.gender === 'male'   ? 'selected' : '' %>>Male</option>
            <option value="female" <%= userBody.gender === 'female' ? 'selected' : '' %>>Female</option>
            <option value="other"  <%= userBody.gender === 'other'  ? 'selected' : '' %>>Other</option>
          </select>
        </div>

        <div class="field">
          <label for="birthday">Date of Birth</label>
          <input type="date" id="birthday" name="birthday" required
                 value="<%= userBody.birthday ? userBody.birthday.toISOString().split('T')[0] : '' %>"/>
        </div>

        <div class="field">
          <label for="activity">Activity Level</label>
          <select id="activity" name="activityLevel" required> <!-- 修改2：name 改成 activityLevel -->
            <option value="">Please choose</option>
            <option value="sedentary" <%= userBody.activityLevel === 'sedentary' ? 'selected' : '' %>>Sedentary (little or no exercise)</option>
            <option value="light"     <%= userBody.activityLevel === 'light'     ? 'selected' : '' %>>Light (1–3 days/week)</option>
            <option value="moderate"  <%= userBody.activityLevel === 'moderate'  ? 'selected' : '' %>>Moderate (3–5 days/week)</option>
            <option value="active"    <%= userBody.activityLevel === 'active'    ? 'selected' : '' %>>Active (6–7 days/week)</option>
            <option value="very_active" <%= userBody.activityLevel === 'very_active' ? 'selected' : '' %>>Very active / Athlete</option>
          </select>
        </div>

        <div class="field full">
          <label for="goal">Goal</label>
          <select id="goal" name="goal" required>
            <option value="">Please choose</option>
            <option value="lose"    <%= userBody.goal === 'lose'    ? 'selected' : '' %>>Lose fat</option>
            <option value="maintain"<%= userBody.goal === 'maintain'? 'selected' : '' %>>Maintain weight</option>
            <option value="gain"    <%= userBody.goal === 'gain'    ? 'selected' : '' %>>Gain muscle / weight</option>
          </select>
        </div>

        <!-- 修改3：只读字段自动显示计算结果 -->
        <div class="field">
          <label>TDEE (kcal/day)</label>
          <input type="number" id="TDEE" readonly 
                 value="<%= userBody.TDEE ? Math.round(userBody.TDEE) : '' %>"
                 style="background:#f8f9fa; color:#e74c3c; font-weight:bold; font-size:1.1em;" />
          <div class="hint">每日总能量消耗（自动计算）</div>
        </div>

        <div class="field">
          <label>Maximum Intake (kcal)</label>
          <input type="number" id="maximumIntake" readonly 
                 value="<%= userBody.maximumIntake || '' %>"
                 style="background:#f8f9fa; color:#27ae60; font-weight:bold;" />
          <div class="hint">建议最高摄入（含盈余）</div>
        </div>

        <div class="field">
          <label>Minimum Intake (kcal)</label>
          <input type="number" id="minimumIntake" readonly 
                 value="<%= userBody.minimumIntake || '' %>"
                 style="background:#f8f9fa; color:#27ae60; font-weight:bold;" />
          <div class="hint">建议最低摄入（含赤字）</div>
        </div>
        
        <div class="actions full">
          <button type="button" class="btn btn-secondary" onclick="history.back()">Back</button>
          <button type="submit" class="btn btn-primary">
            <i class="fa-solid fa-save"></i> Save & Recalculate
          </button>
        </div>
      </form>
    </section>
  </main>
</body>
</html>
